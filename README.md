# üìö Product API Documentation

> **H∆∞·ªõng d·∫´n t√≠ch h·ª£p Backend REST API cho Frontend Developer**

## üìã M·ª•c l·ª•c

- [C·∫•u h√¨nh ban ƒë·∫ßu](#-c·∫•u-h√¨nh-ban-ƒë·∫ßu)
- [C·∫•u tr√∫c Response](#-c·∫•u-tr√∫c-response)
- [Authentication](#-authentication)
- [Products API](#-products-api)
- [Cart API](#-cart-api)
- [Migrations API](#-migrations-api)
- [V√≠ d·ª• t√≠ch h·ª£p](#-v√≠-d·ª•-t√≠ch-h·ª£p)
- [X·ª≠ l√Ω l·ªói](#-x·ª≠-l√Ω-l·ªói)

---

## üöÄ C·∫•u h√¨nh ban ƒë·∫ßu

### Environment Variables

T·∫°o file `.env.local` trong th∆∞ m·ª•c frontend:

```env
NEXT_PUBLIC_API_BASE=http://localhost:3001
```

**L∆∞u √Ω:** 
- M√¥i tr∆∞·ªùng local: `http://localhost:3001`
- M√¥i tr∆∞·ªùng production: thay ƒë·ªïi URL t∆∞∆°ng ·ª©ng

### Base URL

T·∫•t c·∫£ endpoints ƒë·ªÅu b·∫Øt ƒë·∫ßu v·ªõi `/api`:

```
{NEXT_PUBLIC_API_BASE}/api/{endpoint}
```

**V√≠ d·ª•:** `http://localhost:3001/api/products`

---

## üì¶ C·∫•u tr√∫c Response

### ‚úÖ Response th√†nh c√¥ng

```json
{
  "success": true,
  "data": { ... },
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 100,
    "pages": 10
  }
}
```

### ‚ùå Response l·ªói

```json
{
  "success": false,
  "message": "Th√¥ng b√°o l·ªói",
  "error": "Chi ti·∫øt l·ªói (n·∫øu c√≥)",
  "errors": ["Validation error 1", "..."]
}
```

**L∆∞u √Ω:** M·ªôt s·ªë l·ªói validation c√≥ th·ªÉ tr·∫£ v·ªÅ m·∫£ng `errors` thay v√¨ `error` string.

---

## üîê Authentication

### JWT Token Info
- Backend s·ª≠ d·ª•ng JWT v·ªõi `JWT_SECRET` t·ª´ environment
- Token m·∫∑c ƒë·ªãnh h·∫øt h·∫°n sau **7 ng√†y** (c√≥ th·ªÉ config qua `JWT_EXPIRES_IN`)
- Token payload ch·ª©a: `{ id, role, email }`

### 1. ƒêƒÉng k√Ω t√†i kho·∫£n

**Endpoint:** `POST /api/auth/register`

**Request Body:**
```json
{
  "name": "Nguy·ªÖn VƒÉn A",
  "email": "user@example.com",
  "password": "password123",
  "role": "user"  // optional, m·∫∑c ƒë·ªãnh l√† "user"
}
```

**Validation:**
- `name`, `email`, `password` l√† **b·∫Øt bu·ªôc**
- Email ph·∫£i **ch∆∞a t·ªìn t·∫°i** trong h·ªá th·ªëng
- Password s·∫Ω ƒë∆∞·ª£c hash b·∫±ng bcrypt (salt rounds: 10)

**Response th√†nh c√¥ng (201):**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "507f1f77bcf86cd799439011",
      "name": "Nguy·ªÖn VƒÉn A",
      "email": "user@example.com",
      "role": "user"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

**Response l·ªói (400):**
```json
{
  "success": false,
  "message": "Missing required fields"
}
// ho·∫∑c
{
  "success": false,
  "message": "Email already in use"
}
```

**Code example:**
```javascript
import axios from 'axios';

const API_BASE = process.env.NEXT_PUBLIC_API_BASE || 'http://localhost:3001';

const register = async (name, email, password) => {
  try {
    const response = await axios.post(`${API_BASE}/api/auth/register`, {
      name,
      email,
      password
    });
    
    if (response.data.success) {
      const { token, user } = response.data.data;
      // L∆∞u token
      localStorage.setItem('token', token);
      // L∆∞u user info (optional)
      localStorage.setItem('user', JSON.stringify(user));
      
      return { success: true, user, token };
    }
  } catch (error) {
    const message = error.response?.data?.message || 'ƒêƒÉng k√Ω th·∫•t b·∫°i';
    return { success: false, message };
  }
};
```

### 2. ƒêƒÉng nh·∫≠p

**Endpoint:** `POST /api/auth/login`

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Validation:**
- `email` v√† `password` l√† **b·∫Øt bu·ªôc**
- Backend s·∫Ω verify password b·∫±ng bcrypt

**Response th√†nh c√¥ng (200):**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "507f1f77bcf86cd799439011",
      "name": "Nguy·ªÖn VƒÉn A",
      "email": "user@example.com",
      "role": "user"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

**Response l·ªói:**
```json
// 400 - Missing fields
{
  "success": false,
  "message": "Missing email or password"
}

// 401 - Invalid credentials
{
  "success": false,
  "message": "Invalid credentials"
}
```

**Code example:**
```javascript
const login = async (email, password) => {
  try {
    const response = await axios.post(`${API_BASE}/api/auth/login`, {
      email,
      password
    });
    
    if (response.data.success) {
      const { token, user } = response.data.data;
      localStorage.setItem('token', token);
      localStorage.setItem('user', JSON.stringify(user));
      
      return { success: true, user, token };
    }
  } catch (error) {
    if (error.response?.status === 401) {
      return { success: false, message: 'Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng' };
    }
    return { success: false, message: 'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i' };
  }
};
```

### 3. L·∫•y th√¥ng tin user hi·ªán t·∫°i

**Endpoint:** `GET /api/auth/me`

**Headers:** 
```
Authorization: Bearer {token}
```

**Middleware:** S·ª≠ d·ª•ng `authenticate` middleware
- Verify JWT token
- L·∫•y user info t·ª´ database (exclude password)
- Attach user v√†o `req.user`

**Response th√†nh c√¥ng (200):**
```json
{
  "success": true,
  "data": {
    "_id": "507f1f77bcf86cd799439011",
    "name": "Nguy·ªÖn VƒÉn A",
    "email": "user@example.com",
    "role": "user",
    "createdAt": "2024-01-15T10:30:00.000Z"
  }
}
```

**Response l·ªói:**
```json
// 401 - No token
{
  "success": false,
  "message": "No token provided"
}

// 401 - Invalid token
{
  "success": false,
  "message": "Invalid token"
}

// 401 - Token expired ho·∫∑c l·ªói verify
{
  "success": false,
  "message": "Unauthorized",
  "error": "jwt expired"
}
```

**Code example:**
```javascript
const getMe = async () => {
  try {
    const token = localStorage.getItem('token');
    if (!token) {
      return { success: false, message: 'Ch∆∞a ƒëƒÉng nh·∫≠p' };
    }
    
    const response = await axios.get(`${API_BASE}/api/auth/me`, {
      headers: { Authorization: `Bearer ${token}` }
    });
    
    if (response.data.success) {
      return { success: true, user: response.data.data };
    }
  } catch (error) {
    if (error.response?.status === 401) {
      // Token h·∫øt h·∫°n ho·∫∑c kh√¥ng h·ª£p l·ªá
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      return { success: false, message: 'Phi√™n ƒëƒÉng nh·∫≠p h·∫øt h·∫°n' };
    }
    return { success: false, message: 'Kh√¥ng th·ªÉ l·∫•y th√¥ng tin user' };
  }
};
```

---

## üõçÔ∏è Products API

### Product Object Structure

```typescript
interface Product {
  _id: string;
  name: string;
  description?: string;
  price: number;
  stock: number;
  image?: string;
  isActive?: boolean;
  createdAt?: string;
  updatedAt?: string;
}
```

### 1. L·∫•y danh s√°ch s·∫£n ph·∫©m (c√≥ ph√¢n trang & t√¨m ki·∫øm)

**Endpoint:** `GET /api/products`

**Authentication:** ‚ùå Kh√¥ng c·∫ßn

**Query Parameters:**
| Tham s·ªë | Type | M·∫∑c ƒë·ªãnh | M√¥ t·∫£ |
|---------|------|----------|-------|
| page | number | 1 | Trang hi·ªán t·∫°i |
| limit | number | 10 | S·ªë s·∫£n ph·∫©m m·ªói trang |
| search | string | - | T√¨m ki·∫øm theo t√™n s·∫£n ph·∫©m (regex, case-insensitive) |

**Backend Logic:**
- S·ª≠ d·ª•ng MongoDB `$regex` v·ªõi option `i` (case-insensitive)
- Sort theo `createdAt` gi·∫£m d·∫ßn (s·∫£n ph·∫©m m·ªõi nh·∫•t tr∆∞·ªõc)
- Skip = `(page - 1) * limit`

**Response th√†nh c√¥ng (200):**
```json
{
  "success": true,
  "data": [
    {
      "_id": "507f1f77bcf86cd799439011",
      "name": "√Åo thun nam basic",
      "description": "√Åo thun cotton cao c·∫•p",
      "price": 299000,
      "stock": 50,
      "image": "https://example.com/image.jpg",
      "isActive": true,
      "createdAt": "2024-01-15T10:30:00.000Z",
      "updatedAt": "2024-01-15T10:30:00.000Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 45,
    "pages": 5
  }
}
```

**Response l·ªói (500):**
```json
{
  "success": false,
  "message": "L·ªói server khi l·∫•y danh s√°ch s·∫£n ph·∫©m",
  "error": "..."
}
```

**Code example:**
```javascript
const getProducts = async (page = 1, limit = 12, search = '') => {
  try {
    const params = { page, limit };
    if (search) params.search = search;
    
    const response = await axios.get(`${API_BASE}/api/products`, { params });
    
    if (response.data.success) {
      return {
        success: true,
        products: response.data.data,
        pagination: response.data.pagination
      };
    }
  } catch (error) {
    console.error('Error fetching products:', error);
    return { success: false, message: 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch s·∫£n ph·∫©m' };
  }
};

// S·ª≠ d·ª•ng
const result = await getProducts(1, 12, '√°o thun');
console.log(`T√¨m th·∫•y ${result.pagination.total} s·∫£n ph·∫©m`);
console.log(`Trang ${result.pagination.page}/${result.pagination.pages}`);
```

### 2. L·∫•y chi ti·∫øt s·∫£n ph·∫©m

**Endpoint:** `GET /api/products/:id`

**Authentication:** ‚ùå Kh√¥ng c·∫ßn

**Response th√†nh c√¥ng (200):**
```json
{
  "success": true,
  "data": {
    "_id": "507f1f77bcf86cd799439011",
    "name": "√Åo thun nam basic",
    "description": "√Åo thun cotton cao c·∫•p",
    "price": 299000,
    "stock": 50,
    "image": "https://example.com/image.jpg",
    "isActive": true,
    "createdAt": "2024-01-15T10:30:00.000Z"
  }
}
```

**Response l·ªói:**
```json
// 404 - Not found
{
  "success": false,
  "message": "Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"
}

// 500 - Server error
{
  "success": false,
  "message": "L·ªói server khi l·∫•y th√¥ng tin s·∫£n ph·∫©m",
  "error": "..."
}
```

**Code example:**
```javascript
const getProductById = async (id) => {
  try {
    const response = await axios.get(`${API_BASE}/api/products/${id}`);
    
    if (response.data.success) {
      return { success: true, product: response.data.data };
    }
  } catch (error) {
    if (error.response?.status === 404) {
      return { success: false, message: 'Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m' };
    }
    return { success: false, message: 'Kh√¥ng th·ªÉ t·∫£i th√¥ng tin s·∫£n ph·∫©m' };
  }
};
```

### 3. T·∫°o s·∫£n ph·∫©m m·ªõi

**Endpoint:** `POST /api/products`

**Authentication:** ‚ùå Kh√¥ng c·∫ßn (nh∆∞ng n√™n th√™m trong production)

**Request Body:**
```json
{
  "name": "√Åo thun nam basic",
  "description": "√Åo thun cotton cao c·∫•p",
  "price": 299000,
  "stock": 50,
  "image": "https://example.com/image.jpg",
  "isActive": true
}
```

**Validation:** D·ª±a v√†o Product model schema

**Response th√†nh c√¥ng (201):**
```json
{
  "success": true,
  "message": "T·∫°o s·∫£n ph·∫©m th√†nh c√¥ng",
  "data": {
    "_id": "507f1f77bcf86cd799439011",
    "name": "√Åo thun nam basic",
    "price": 299000,
    ...
  }
}
```

**Response l·ªói:**
```json
// 400 - Validation error
{
  "success": false,
  "message": "D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá",
  "errors": [
    "Name is required",
    "Price must be a positive number"
  ]
}

// 500 - Server error
{
  "success": false,
  "message": "L·ªói server khi t·∫°o s·∫£n ph·∫©m",
  "error": "..."
}
```

**Code example:**
```javascript
const createProduct = async (productData) => {
  try {
    const response = await axios.post(`${API_BASE}/api/products`, productData);
    
    if (response.data.success) {
      return { 
        success: true, 
        message: 'T·∫°o s·∫£n ph·∫©m th√†nh c√¥ng',
        product: response.data.data 
      };
    }
  } catch (error) {
    if (error.response?.status === 400) {
      const errors = error.response.data.errors || [error.response.data.message];
      return { success: false, errors };
    }
    return { success: false, message: 'Kh√¥ng th·ªÉ t·∫°o s·∫£n ph·∫©m' };
  }
};

// S·ª≠ d·ª•ng
const newProduct = {
  name: '√Åo thun nam',
  description: '√Åo thun cotton',
  price: 299000,
  stock: 50,
  image: 'https://example.com/image.jpg'
};

const result = await createProduct(newProduct);
```

### 4. C·∫≠p nh·∫≠t s·∫£n ph·∫©m

**Endpoint:** `PUT /api/products/:id`

**Authentication:** ‚ùå Kh√¥ng c·∫ßn (nh∆∞ng n√™n th√™m trong production)

**Request Body:** C√°c tr∆∞·ªùng c·∫ßn c·∫≠p nh·∫≠t (kh√¥ng c·∫ßn g·ª≠i t·∫•t c·∫£)

```json
{
  "price": 250000,
  "stock": 30
}
```

**Backend Options:**
- `new: true` - Tr·∫£ v·ªÅ document sau khi update
- `runValidators: true` - Ch·∫°y validation khi update

**Response th√†nh c√¥ng (200):**
```json
{
  "success": true,
  "message": "C·∫≠p nh·∫≠t s·∫£n ph·∫©m th√†nh c√¥ng",
  "data": {
    "_id": "507f1f77bcf86cd799439011",
    "name": "√Åo thun nam basic",
    "price": 250000,
    "stock": 30,
    ...
  }
}
```

**Response l·ªói:**
```json
// 404 - Not found
{
  "success": false,
  "message": "Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"
}

// 400 - Validation error
{
  "success": false,
  "message": "D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá",
  "errors": ["Price must be positive"]
}
```

**Code example:**
```javascript
const updateProduct = async (id, updates) => {
  try {
    const response = await axios.put(`${API_BASE}/api/products/${id}`, updates);
    
    if (response.data.success) {
      return { 
        success: true, 
        message: 'C·∫≠p nh·∫≠t th√†nh c√¥ng',
        product: response.data.data 
      };
    }
  } catch (error) {
    if (error.response?.status === 404) {
      return { success: false, message: 'Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m' };
    }
    if (error.response?.status === 400) {
      const errors = error.response.data.errors || [error.response.data.message];
      return { success: false, errors };
    }
    return { success: false, message: 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t s·∫£n ph·∫©m' };
  }
};
```

### 5. X√≥a s·∫£n ph·∫©m (Admin only)

**Endpoint:** `DELETE /api/products/:id`

**Authentication:** ‚úÖ **B·∫Øt bu·ªôc** (Admin role)

**Middleware chain:**
1. `authenticate` - Verify JWT token
2. `authorizeRole('admin')` - Check user role

**Headers:**
```
Authorization: Bearer {token}
```

**Response th√†nh c√¥ng (200):**
```json
{
  "success": true,
  "message": "X√≥a s·∫£n ph·∫©m th√†nh c√¥ng"
}
```

**Response l·ªói:**
```json
// 401 - No token ho·∫∑c invalid token
{
  "success": false,
  "message": "Unauthorized"
}

// 403 - Not admin
{
  "success": false,
  "message": "Forbidden: insufficient rights"
}

// 404 - Not found
{
  "success": false,
  "message": "Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"
}
```

**Code example:**
```javascript
const deleteProduct = async (id) => {
  try {
    const token = localStorage.getItem('token');
    if (!token) {
      return { success: false, message: 'Vui l√≤ng ƒëƒÉng nh·∫≠p' };
    }
    
    const response = await axios.delete(`${API_BASE}/api/products/${id}`, {
      headers: { Authorization: `Bearer ${token}` }
    });
    
    if (response.data.success) {
      return { success: true, message: 'X√≥a s·∫£n ph·∫©m th√†nh c√¥ng' };
    }
  } catch (error) {
    if (error.response?.status === 401) {
      return { success: false, message: 'Vui l√≤ng ƒëƒÉng nh·∫≠p' };
    }
    if (error.response?.status === 403) {
      return { success: false, message: 'B·∫°n kh√¥ng c√≥ quy·ªÅn x√≥a s·∫£n ph·∫©m' };
    }
    if (error.response?.status === 404) {
      return { success: false, message: 'Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m' };
    }
    return { success: false, message: 'Kh√¥ng th·ªÉ x√≥a s·∫£n ph·∫©m' };
  }
};
```

---

## üõí Cart API

> **L∆∞u √Ω:** T·∫•t c·∫£ endpoints gi·ªè h√†ng ƒë·ªÅu y√™u c·∫ßu authentication

### Cart Object Structure

```typescript
interface Cart {
  _id: string;
  user: string;  // User ID
  items: CartItem[];
  createdAt: string;
  updatedAt: string;
}

interface CartItem {
  product: string | Product;  // Product ID ho·∫∑c populated Product object
  name: string;
  price: number;
  quantity: number;
  _id: string;
}
```

**Backend behavior:**
- Cart items ƒë∆∞·ª£c populate v·ªõi th√¥ng tin product ƒë·∫ßy ƒë·ªß
- N·∫øu user ch∆∞a c√≥ cart, backend t·ª± ƒë·ªông t·∫°o m·ªõi
- Item `name` v√† `price` ƒë∆∞·ª£c l∆∞u tr·ªØ t·∫°i th·ªùi ƒëi·ªÉm th√™m v√†o cart (snapshot)

### 1. L·∫•y gi·ªè h√†ng c·ªßa user

**Endpoint:** `GET /api/cart`

**Authentication:** ‚úÖ **B·∫Øt bu·ªôc**

**Headers:**
```
Authorization: Bearer {token}
```

**Backend Logic:**
- T√¨m cart theo `req.user._id` (t·ª´ authenticate middleware)
- N·∫øu ch∆∞a c√≥ cart ‚Üí t·ª± ƒë·ªông t·∫°o m·ªõi v·ªõi `items: []`
- Populate `items.product` v·ªõi th√¥ng tin ƒë·∫ßy ƒë·ªß

**Response th√†nh c√¥ng (200):**
```json
{
  "success": true,
  "data": {
    "_id": "cart_id",
    "user": "user_id",
    "items": [
      {
        "_id": "item_id",
        "product": {
          "_id": "product_id",
          "name": "√Åo thun nam basic",
          "price": 299000,
          "stock": 50,
          "image": "https://example.com/image.jpg"
        },
        "name": "√Åo thun nam basic",
        "price": 299000,
        "quantity": 2
      }
    ],
    "createdAt": "2024-01-15T10:30:00.000Z",
    "updatedAt": "2024-01-15T11:00:00.000Z"
  }
}
```

**Response l·ªói (500):**
```json
{
  "success": false,
  "message": "Server error",
  "error": "..."
}
```

**Code example:**
```javascript
const getCart = async () => {
  try {
    const token = localStorage.getItem('token');
    const response = await axios.get(`${API_BASE}/api/cart`, {
      headers: { Authorization: `Bearer ${token}` }
    });
    
    if (response.data.success) {
      const cart = response.data.data;
      const totalItems = cart.items.reduce((sum, item) => sum + item.quantity, 0);
      const totalPrice = cart.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      
      return { 
        success: true, 
        cart,
        totalItems,
        totalPrice
      };
    }
  } catch (error) {
    console.error('Error fetching cart:', error);
    return { success: false, message: 'Kh√¥ng th·ªÉ t·∫£i gi·ªè h√†ng' };
  }
};
```

### 2. Th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng

**Endpoint:** `POST /api/cart`

**Authentication:** ‚úÖ **B·∫Øt bu·ªôc**

**Headers:**
```
Authorization: Bearer {token}
```

**Request Body:**
```json
{
  "productId": "507f1f77bcf86cd799439011",
  "quantity": 2  // optional, m·∫∑c ƒë·ªãnh 1
}
```

**Backend Logic:**
1. Validate `productId` c√≥ t·ªìn t·∫°i kh√¥ng
2. T√¨m/t·∫°o cart c·ªßa user
3. N·∫øu product ƒë√£ c√≥ trong cart ‚Üí tƒÉng quantity
4. N·∫øu ch∆∞a c√≥ ‚Üí th√™m item m·ªõi v·ªõi `name`, `price` t·ª´ product
5. Save cart v√† populate items

**Response th√†nh c√¥ng (200):**
```json
{
  "success": true,
  "data": {
    "_id": "cart_id",
    "user": "user_id",
    "items": [
      {
        "_id": "item_id",
        "product": { ... },  // populated
        "name": "√Åo thun nam basic",
        "price": 299000,
        "quantity": 2
      }
    ]
  }
}
```

**Response l·ªói:**
```json
// 400 - Missing productId
{
  "success": false,
  "message": "productId is required"
}

// 404 - Product not found
{
  "success": false,
  "message": "Product not found"
}

// 401 - Unauthorized
{
  "success": false,
  "message": "Unauthorized"
}
```

**Code example:**
```javascript
const addToCart = async (productId, quantity = 1) => {
  try {
    const token = localStorage.getItem('token');
    if (!token) {
      return { success: false, message: 'Vui l√≤ng ƒëƒÉng nh·∫≠p' };
    }
    
    const response = await axios.post(
      `${API_BASE}/api/cart`,
      { productId, quantity },
      { headers: { Authorization: `Bearer ${token}` } }
    );
    
    if (response.data.success) {
      return { 
        success: true, 
        message: 'ƒê√£ th√™m v√†o gi·ªè h√†ng',
        cart: response.data.data 
      };
    }
  } catch (error) {
    if (error.response?.status === 404) {
      return { success: false, message: 'S·∫£n ph·∫©m kh√¥ng t·ªìn t·∫°i' };
    }
    if (error.response?.status === 401) {
      return { success: false, message: 'Vui l√≤ng ƒëƒÉng nh·∫≠p' };
    }
    return { success: false, message: 'Kh√¥ng th·ªÉ th√™m v√†o gi·ªè h√†ng' };
  }
};

// S·ª≠ d·ª•ng v·ªõi notification
const handleAddToCart = async (productId) => {
  const result = await addToCart(productId, 1);
  if (result.success) {
    toast.success(result.message); // Assuming you use a toast library
    // Update cart count in header
    updateCartCount(result.cart.items.length);
  } else {
    toast.error(result.message);
  }
};
```

### 3. C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng s·∫£n ph·∫©m

**Endpoint:** `PUT /api/cart/:productId`

**Authentication:** ‚úÖ **B·∫Øt bu·ªôc**

**Headers:**
```
Authorization: Bearer {token}
```

**Request Body:**
```json
{
  "quantity": 5
}
```

**Validation:**
- `quantity` ph·∫£i >= 1
- `productId` ph·∫£i t·ªìn t·∫°i trong cart

**Backend Logic:**
1. T√¨m cart c·ªßa user
2. T√¨m item c√≥ `product` matching `productId`
3. Update quantity
4. Save v√† populate

**Response th√†nh c√¥ng (200):**
```json
{
  "success": true,
  "data": {
    "_id": "cart_id",
    "user": "user_id",
    "items": [
      {
        "product": { ... },
        "name": "√Åo thun nam basic",
        "price": 299000,
        "quantity": 5  // updated
      }
    ]
  }
}
```

**Response l·ªói:**
```json
// 400 - Invalid quantity
{
  "success": false,
  "message": "quantity must be >= 1"
}

// 404 - Cart not found
{
  "success": false,
  "message": "Cart not found"
}

// 404 - Item not in cart
{
  "success": false,
  "message": "Item not found in cart"
}
```

**Code example:**
```javascript
const updateCartItemQuantity = async (productId, quantity) => {
  try {
    if (quantity < 1) {
      return { success: false, message: 'S·ªë l∆∞·ª£ng ph·∫£i l·ªõn h∆°n 0' };
    }
    
    const token = localStorage.getItem('token');
    const response = await axios.put(
      `${API_BASE}/api/cart/${productId}`,
      { quantity },
      { headers: { Authorization: `Bearer ${token}` } }
    );
    
    if (response.data.success) {
      return { 
        success: true, 
        message: 'ƒê√£ c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng',
        cart: response.data.data 
      };
    }
  } catch (error) {
    if (error.response?.status === 404) {
      return { success: false, message: 'S·∫£n ph·∫©m kh√¥ng c√≥ trong gi·ªè h√†ng' };
    }
    return { success: false, message: 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng' };
  }
};

// S·ª≠ d·ª•ng v·ªõi input number
const handleQuantityChange = async (productId, newQuantity) => {
  const result = await updateCartItemQuantity(productId, newQuantity);
  if (result.success) {
    // Update UI with result.cart
    setCart(result.cart);
  } else {
    toast.error(result.message);
  }
};
```

### 4. X√≥a s·∫£n ph·∫©m kh·ªèi gi·ªè h√†ng

**Endpoint:** `DELETE /api/cart/:productId`

**Authentication:** ‚úÖ **B·∫Øt bu·ªôc**

**Headers:**
```
Authorization: Bearer {token}
```

**Backend Logic:**
- Filter out item c√≥ `product` matching `productId`
- Save cart v√† populate

**Response th√†nh c√¥ng (200):**
```json
{
  "success": true,
  "data": {
    "_id": "cart_id",
    "user": "user_id",
    "items": [
      // Remaining items after deletion
    ]
  }
}
```

**Response l·ªói:**
```json
// 404 - Cart not found
{
  "success": false,
  "message": "Cart not found"
}
```

**Code example:**
```javascript
const removeFromCart = async (productId) => {
  try {
    const token = localStorage.getItem('token');
    const response = await axios.delete(
      `${API_BASE}/api/cart/${productId}`,
      { headers: { Authorization: `Bearer ${token}` } }
    );
    
    if (response.data.success) {
      return { 
        success: true, 
        message: 'ƒê√£ x√≥a kh·ªèi gi·ªè h√†ng',
        cart: response.data.data 
      };
    }
  } catch (error) {
    if (error.response?.status === 404) {
      return { success: false, message: 'Kh√¥ng t√¨m th·∫•y gi·ªè h√†ng' };
    }
    return { success: false, message: 'Kh√¥ng th·ªÉ x√≥a s·∫£n ph·∫©m' };
  }
};

// S·ª≠ d·ª•ng v·ªõi confirm dialog
const handleRemoveItem = async (productId, productName) => {
  if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a "${productName}" kh·ªèi gi·ªè h√†ng?`)) {
    const result = await removeFromCart(productId);
    if (result.success) {
      toast.success(result.message);
      setCart(result.cart);
    } else {
      toast.error(result.message);
    }
  }
};
```

### 5. X√≥a to√†n b·ªô gi·ªè h√†ng

**Endpoint:** `DELETE /api/cart`

**Authentication:** ‚úÖ **B·∫Øt bu·ªôc**

**Headers:**
```
Authorization: Bearer {token}
```

**Backend Logic:**
- Set `cart.items = []`
- Save cart

**Response th√†nh c√¥ng (200):**
```json
{
  "success": true,
  "data": {
    "_id": "cart_id",
    "user": "user_id",
    "items": []
  }
}
```

**Response l·ªói:**
```json
// 404 - Cart not found
{
  "success": false,
  "message": "Cart not found"
}
```

**Code example:**
```javascript
const clearCart = async () => {
  try {
    const token = localStorage.getItem('token');
    const response = await axios.delete(`${API_BASE}/api/cart`, {
      headers: { Authorization: `Bearer ${token}` }
    });
    
    if (response.data.success) {
      return { 
        success: true, 
        message: 'ƒê√£ x√≥a to√†n b·ªô gi·ªè h√†ng',
        cart: response.data.data 
      };
    }
  } catch (error) {
    return { success: false, message: 'Kh√¥ng th·ªÉ x√≥a gi·ªè h√†ng' };
  }
};

// S·ª≠ d·ª•ng sau khi checkout th√†nh c√¥ng
const handleCheckoutSuccess = async () => {
  const result = await clearCart();
  if (result.success) {
    // Redirect to success page
    router.push('/checkout/success');
  }
};
```

---

## üîÑ Migrations API

### Reset & Seed Database

**Endpoint:** `POST /api/migrations/reset`

**Authentication:** ‚ùå Kh√¥ng c·∫ßn

**M√¥ t·∫£:** 
- Drop to√†n b·ªô collections trong database
- Seed l·∫°i d·ªØ li·ªáu m·∫´u (products, users, etc.)

**‚ö†Ô∏è C·∫¢NH B√ÅO:**
- **CH·ªà S·ª¨ D·ª§NG TRONG DEVELOPMENT**
- **KH√îNG BAO GI·ªú D√ôNG TRONG PRODUCTION**
- S·∫Ω x√≥a to√†n b·ªô d·ªØ li·ªáu hi·ªán c√≥

**Response:**
```json
{
  "success": true,
  "message": "Database reset and seeded successfully"
}
```

**Code example:**
```javascript
const resetDatabase = async () => {
  if (process.env.NODE_ENV === 'production') {
    console.error('Cannot reset database in production!');
    return;
  }
  
  if (!confirm('C·∫¢NH B√ÅO: H√†nh ƒë·ªông n√†y s·∫Ω x√≥a to√†n b·ªô d·ªØ li·ªáu. B·∫°n c√≥ ch·∫Øc?')) {
    return;
  }
  
  try {
    const response = await axios.post(`${API_BASE}/api/migrations/reset`);
    if (response.data.success) {
      alert('Database ƒë√£ ƒë∆∞·ª£c reset th√†nh c√¥ng!');
      window.location.reload();
    }
  } catch (error) {
    console.error('Error resetting database:', error);
    alert('Kh√¥ng th·ªÉ reset database');
  }
};
```

---

## üí° V√≠ d·ª• t√≠ch h·ª£p

### Setup Axios Instance (Recommended)

T·∫°o file `src/lib/api.ts`:

```typescript
import axios from 'axios';

const API_BASE = process.env.NEXT_PUBLIC_API_BASE || 'http://localhost:3001';

// T·∫°o axios instance
export const api = axios.create({
  baseURL: API_BASE,
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request interceptor - T·ª± ƒë·ªông th√™m token
api.interceptors.request.use(
  (config) => {
    if (typeof window !== 'undefined') {
      const token = localStorage.getItem('token');
      if (token) {
        config.headers.Authorization = `Bearer ${token}`;
      }
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Response interceptor - X·ª≠ l√Ω l·ªói t·∫≠p trung
api.interceptors.response.use(
  (response) => response,
  (error) => {
    // Token h·∫øt h·∫°n ho·∫∑c kh√¥ng h·ª£p l·ªá
    if (error.response?.status === 401) {
      if (typeof window !== 'undefined') {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        // Redirect to login
        if (!window.location.pathname.includes('/login')) {
          window.location.href = '/login?expired=true';
        }
      }
    }
    
    // Forbidden
    if (error.response?.status === 403) {
      console.error('Access forbidden');
    }
    
    return Promise.reject(error);
  }
);

export default api;
```

### Service Layer Pattern

T·∫°o file `src/services/authService.ts`:

```typescript
import api from '@/lib/api';

interface RegisterData {
  name: string;
  email: string;
  password: string;
  role?: string;
}

interface LoginData {
  email: string;
  password: string;
}

export const authService = {
  // ƒêƒÉng k√Ω
  register: async (data: RegisterData) => {
    const response = await api.post('/api/auth/register', data);
    if (response.data.success) {
      const { token, user } = response.data.data;
      localStorage.setItem('token', token);
      localStorage.setItem('user', JSON.stringify(user));
    }
    return response.data;
  },

  // ƒêƒÉng nh·∫≠p
  login: async (data: LoginData) => {
    const response = await api.post('/api/auth/login', data);
    if (response.data.success) {
      const { token, user } = response.data.data;
      localStorage.setItem('token', token);
      localStorage.setItem('user', JSON.stringify(user));
    }
    return response.data;
  },

  // ƒêƒÉng xu·∫•t
  logout: () => {
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    window.location.href = '/login';
  },

  // L·∫•y th√¥ng tin user
  getMe: async () => {
    const response = await api.get('/api/auth/me');
    return response.data;
  },

  // Ki·ªÉm tra ƒë√£ ƒëƒÉng nh·∫≠p
  isAuthenticated: () => {
    return !!localStorage.getItem('token');
  },

  // L·∫•y user t·ª´ localStorage
  getCurrentUser: () => {
    const userStr = localStorage.getItem('user');
    return userStr ? JSON.parse(userStr) : null;
  },
};
```

T·∫°o file `src/services/productService.ts`:

```typescript
import api from '@/lib/api';

export const productService = {
  // L·∫•y danh s√°ch s·∫£n ph·∫©m
  getAll: async (params: { page?: number; limit?: number; search?: string } = {}) => {
    const response = await api.get('/api/products', { params });
    return response.data;
  },

  // L·∫•y chi ti·∫øt s·∫£n ph·∫©m
  getById: async (id: string) => {
    const response = await api.get(`/api/products/${id}`);
    return response.data;
  },

  // T·∫°o s·∫£n ph·∫©m
  create: async (data: any) => {
    const response = await api.post('/api/products', data);
    return response.data;
  },

  // C·∫≠p nh·∫≠t s·∫£n ph·∫©m
  update: async (id: string, data: any) => {
    const response = await api.put(`/api/products/${id}`, data);
    return response.data;
  },

  // X√≥a s·∫£n ph·∫©m
  delete: async (id: string) => {
    const response = await api.delete(`/api/products/${id}`);
    return response.data;
  },
};
```

T·∫°o file `src/services/cartService.ts`:

```typescript
import api from '@/lib/api';

export const cartService = {
  // L·∫•y gi·ªè h√†ng
  get: async () => {
    const response = await api.get('/api/cart');
    return response.data;
  },

  // Th√™m v√†o gi·ªè
  addItem: async (productId: string, quantity: number = 1) => {
    const response = await api.post('/api/cart', { productId, quantity });
    return response.data;
  },

  // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng
  updateItem: async (productId: string, quantity: number) => {
    const response = await api.put(`/api/cart/${productId}`, { quantity });
    return response.data;
  },

  // X√≥a s·∫£n ph·∫©m
  removeItem: async (productId: string) => {
    const response = await api.delete(`/api/cart/${productId}`);
    return response.data;
  },

  // X√≥a to√†n b·ªô gi·ªè
  clear: async () => {
    const response = await api.delete('/api/cart');
    return response.data;
  },
};
```

### React Custom Hooks

T·∫°o file `src/hooks/useAuth.ts`:

```typescript
import { useState, useEffect } from 'react';
import { authService } from '@/services/authService';

export function useAuth() {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    checkAuth();
  }, []);

  const checkAuth = async () => {
    try {
      if (authService.isAuthenticated()) {
        const response = await authService.getMe();
        if (response.success) {
          setUser(response.data);
        }
      }
    } catch (error) {
      console.error('Auth check failed:', error);
      authService.logout();
    } finally {
      setLoading(false);
    }
  };

  const login = async (email: string, password: string) => {
    try {
      const response = await authService.login({ email, password });
      if (response.success) {
        setUser(response.data.user);
        return { success: true };
      }
      return { success: false, message: response.message };
    } catch (error: any) {
      return { 
        success: false, 
        message: error.response?.data?.message || 'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i' 
      };
    }
  };

  const register = async (name: string, email: string, password: string) => {
    try {
      const response = await authService.register({ name, email, password });
      if (response.success) {
        setUser(response.data.user);
        return { success: true };
      }
      return { success: false, message: response.message };
    } catch (error: any) {
      return { 
        success: false, 
        message: error.response?.data?.message || 'ƒêƒÉng k√Ω th·∫•t b·∫°i' 
      };
    }
  };

  const logout = () => {
    authService.logout();
    setUser(null);
  };

  return { user, loading, login, register, logout, isAuthenticated: !!user };
}
```

T·∫°o file `src/hooks/useProducts.ts`:

```typescript
import { useState, useEffect } from 'react';
import { productService } from '@/services/productService';

export function useProducts(page = 1, limit = 12, search = '') {
  const [products, setProducts] = useState([]);
  const [pagination, setPagination] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  useEffect(() => {
    fetchProducts();
  }, [page, limit, search]);

  const fetchProducts = async () => {
    setLoading(true);
    setError(null);
    
    try {
      const response = await productService.getAll({ page, limit, search });
      
      if (response.success) {
        setProducts(response.data);
        setPagination(response.pagination);
      }
    } catch (err: any) {
      setError(err.response?.data?.message || 'Kh√¥ng th·ªÉ t·∫£i s·∫£n ph·∫©m');
    } finally {
      setLoading(false);
    }
  };

  const refetch = () => {
    fetchProducts();
  };

  return { products, pagination, loading, error, refetch };
}
```

T·∫°o file `src/hooks/useCart.ts`:

```typescript
import { useState, useEffect } from 'react';
import { cartService } from '@/services/cartService';
import { useAuth } from './useAuth';

export function useCart() {
  const { isAuthenticated } = useAuth();
  const [cart, setCart] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  useEffect(() => {
    if (isAuthenticated) {
      fetchCart();
    }
  }, [isAuthenticated]);

  const fetchCart = async () => {
    setLoading(true);
    setError(null);
    
    try {
      const response = await cartService.get();
      if (response.success) {
        setCart(response.data);
      }
    } catch (err: any) {
      setError(err.response?.data?.message || 'Kh√¥ng th·ªÉ t·∫£i gi·ªè h√†ng');
    } finally {
      setLoading(false);
    }
  };

  const addItem = async (productId: string, quantity: number = 1) => {
    try {
      const response = await cartService.addItem(productId, quantity);
      if (response.success) {
        setCart(response.data);
        return { success: true, message: 'ƒê√£ th√™m v√†o gi·ªè h√†ng' };
      }
    } catch (err: any) {
      return { 
        success: false, 
        message: err.response?.data?.message || 'Kh√¥ng th·ªÉ th√™m v√†o gi·ªè' 
      };
    }
  };

  const updateItem = async (productId: string, quantity: number) => {
    try {
      const response = await cartService.updateItem(productId, quantity);
      if (response.success) {
        setCart(response.data);
        return { success: true };
      }
    } catch (err: any) {
      return { 
        success: false, 
        message: err.response?.data?.message || 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t' 
      };
    }
  };

  const removeItem = async (productId: string) => {
    try {
      const response = await cartService.removeItem(productId);
      if (response.success) {
        setCart(response.data);
        return { success: true, message: 'ƒê√£ x√≥a kh·ªèi gi·ªè h√†ng' };
      }
    } catch (err: any) {
      return { 
        success: false, 
        message: err.response?.data?.message || 'Kh√¥ng th·ªÉ x√≥a' 
      };
    }
  };

  const clearCart = async () => {
    try {
      const response = await cartService.clear();
      if (response.success) {
        setCart(response.data);
        return { success: true };
      }
    } catch (err: any) {
      return { success: false };
    }
  };

  const totalItems = cart?.items.reduce((sum, item) => sum + item.quantity, 0) || 0;
  const totalPrice = cart?.items.reduce((sum, item) => sum + (item.price * item.quantity), 0) || 0;

  return { 
    cart, 
    loading, 
    error, 
    addItem, 
    updateItem, 
    removeItem, 
    clearCart,
    refetch: fetchCart,
    totalItems,
    totalPrice
  };
}
```

### S·ª≠ d·ª•ng trong Component

```tsx
// pages/products/index.tsx
import { useProducts } from '@/hooks/useProducts';
import { useCart } from '@/hooks/useCart';
import { useState } from 'react';

export default function ProductsPage() {
  const [page, setPage] = useState(1);
  const [search, setSearch] = useState('');
  const { products, pagination, loading } = useProducts(page, 12, search);
  const { addItem } = useCart();

  const handleAddToCart = async (productId: string) => {
    const result = await addItem(productId, 1);
    if (result.success) {
      alert(result.message);
    } else {
      alert(result.message);
    }
  };

  if (loading) return <div>ƒêang t·∫£i...</div>;

  return (
    <div>
      <input
        type="text"
        placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..."
        value={search}
        onChange={(e) => setSearch(e.target.value)}
      />

      <div className="grid grid-cols-4 gap-4">
        {products.map((product) => (
          <div key={product._id} className="border p-4">
            <img src={product.image} alt={product.name} />
            <h3>{product.name}</h3>
            <p>{product.price.toLocaleString('vi-VN')}ƒë</p>
            <button onClick={() => handleAddToCart(product._id)}>
              Th√™m v√†o gi·ªè
            </button>
          </div>
        ))}
      </div>

      {pagination && (
        <div className="flex gap-2 mt-4">
          {Array.from({ length: pagination.pages }, (_, i) => i + 1).map((p) => (
            <button
              key={p}
              onClick={() => setPage(p)}
              className={p === page ? 'font-bold' : ''}
            >
              {p}
            </button>
          ))}
        </div>
      )}
    </div>
  );
}
```

```tsx
// pages/cart/index.tsx
import { useCart } from '@/hooks/useCart';

export default function CartPage() {
  const { cart, loading, updateItem, removeItem, totalPrice } = useCart();

  if (loading) return <div>ƒêang t·∫£i...</div>;
  if (!cart || cart.items.length === 0) return <div>Gi·ªè h√†ng tr·ªëng</div>;

  return (
    <div>
      <h1>Gi·ªè h√†ng c·ªßa b·∫°n</h1>
      
      {cart.items.map((item) => (
        <div key={item._id} className="flex items-center gap-4 p-4 border-b">
          <img src={item.product.image} alt={item.name} className="w-20 h-20" />
          <div className="flex-1">
            <h3>{item.name}</h3>
            <p>{item.price.toLocaleString('vi-VN')}ƒë</p>
          </div>
          <input
            type="number"
            min="1"
            value={item.quantity}
            onChange={(e) => updateItem(item.product._id, parseInt(e.target.value))}
            className="w-20"
          />
          <button onClick={() => removeItem(item.product._id)}>X√≥a</button>
        </div>
      ))}

      <div className="mt-4 text-xl font-bold">
        T·ªïng: {totalPrice.toLocaleString('vi-VN')}ƒë
      </button>
    </div>
  );
}
```

---

## ‚ö†Ô∏è X·ª≠ l√Ω l·ªói

### C√°c lo·∫°i l·ªói th∆∞·ªùng g·∫∑p

| Status Code | √ù nghƒ©a | X·ª≠ l√Ω trong code |
|-------------|---------|------------------|
| 400 | Bad Request - D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá | Ki·ªÉm tra validation, hi·ªÉn th·ªã `errors` array |
| 401 | Unauthorized - Ch∆∞a ƒëƒÉng nh·∫≠p/token h·∫øt h·∫°n | X√≥a token, redirect v·ªÅ /login |
| 403 | Forbidden - Kh√¥ng c√≥ quy·ªÅn | Hi·ªÉn th·ªã th√¥ng b√°o, kh√¥ng cho ph√©p thao t√°c |
| 404 | Not Found - Kh√¥ng t√¨m th·∫•y resource | Hi·ªÉn th·ªã trang 404 ho·∫∑c th√¥ng b√°o |
| 500 | Server Error | Hi·ªÉn th·ªã l·ªói chung, log error ƒë·ªÉ debug |

### Error Response Types

Backend tr·∫£ v·ªÅ c√°c ki·ªÉu l·ªói kh√°c nhau:

```typescript
// Type 1: Simple error
{
  success: false,
  message: "Error message"
}

// Type 2: Error with details
{
  success: false,
  message: "Error message",
  error: "Detailed error info"
}

// Type 3: Validation errors (array)
{
  success: false,
  message: "D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá",
  errors: ["Field 1 error", "Field 2 error"]
}
```

### Complete Error Handling Example

```typescript
import axios, { AxiosError } from 'axios';

interface ApiError {
  success: false;
  message: string;
  error?: string;
  errors?: string[];
}

async function handleApiCall<T>(apiCall: () => Promise<any>): Promise<{
  success: boolean;
  data?: T;
  message?: string;
  errors?: string[];
}> {
  try {
    const response = await apiCall();
    
    if (response.data.success) {
      return {
        success: true,
        data: response.data.data,
      };
    }
    
    return {
      success: false,
      message: response.data.message,
    };
  } catch (error) {
    if (axios.isAxiosError(error)) {
      const axiosError = error as AxiosError<ApiError>;
      const status = axiosError.response?.status;
      const errorData = axiosError.response?.data;
      
      // Network error
      if (!axiosError.response) {
        return {
          success: false,
          message: 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.',
        };
      }
      
      // Handle specific status codes
      switch (status) {
        case 400:
          return {
            success: false,
            message: errorData?.message || 'D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá',
            errors: errorData?.errors,
          };
          
        case 401:
          // Auto logout handled by interceptor
          return {
            success: false,
            message: 'Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.',
          };
          
        case 403:
          return {
            success: false,
            message: 'B·∫°n kh√¥ng c√≥ quy·ªÅn th·ª±c hi·ªán h√†nh ƒë·ªông n√†y.',
          };
          
        case 404:
          return {
            success: false,
            message: errorData?.message || 'Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu.',
          };
          
        case 500:
          return {
            success: false,
            message: 'L·ªói server. Vui l√≤ng th·ª≠ l·∫°i sau.',
          };
          
        default:
          return {
            success: false,
            message: errorData?.message || 'C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.',
          };
      }
    }
    
    // Unknown error
    return {
      success: false,
      message: 'C√≥ l·ªói kh√¥ng x√°c ƒë·ªãnh x·∫£y ra.',
    };
  }
}

// S·ª≠ d·ª•ng
const result = await handleApiCall(() => 
  api.post('/api/products', productData)
);

if (result.success) {
  console.log('Product created:', result.data);
} else {
  console.error('Error:', result.message);
  if (result.errors) {
    result.errors.forEach(err => console.error('- ', err));
  }
}
```

### CORS Issues

N·∫øu g·∫∑p l·ªói CORS:

**Tri·ªáu ch·ª©ng:**
```
Access to XMLHttpRequest at 'http://localhost:3001/api/products' from origin 
'http://localhost:3000' has been blocked by CORS policy
```

**Nguy√™n nh√¢n:**
- Backend ch∆∞a c·∫•u h√¨nh CORS
- Frontend origin kh√¥ng ƒë∆∞·ª£c cho ph√©p
- Thi·∫øu credentials config

**Gi·∫£i ph√°p:**

1. **Ki·ªÉm tra backend CORS config** (trong `server.js`):
```javascript
import cors from 'cors';

app.use(cors({
  origin: ['http://localhost:3000', 'https://your-frontend.com'],
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE'],
  allowedHeaders: ['Content-Type', 'Authorization']
}));
```

2. **Ki·ªÉm tra `.env.local`**:
```env
NEXT_PUBLIC_API_BASE=http://localhost:3001
```

3. **N·∫øu d√πng credentials**, th√™m v√†o axios config:
```javascript
axios.defaults.withCredentials = true;
```

---

## üìÅ C·∫•u tr√∫c th∆∞ m·ª•c ƒë·ªÅ xu·∫•t

```
src/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ api.ts              # Axios instance v·ªõi interceptors
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ authService.ts      # Auth API calls
‚îÇ   ‚îú‚îÄ‚îÄ productService.ts   # Product API calls
‚îÇ   ‚îî‚îÄ‚îÄ cartService.ts      # Cart API calls
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts          # Authentication hook
‚îÇ   ‚îú‚îÄ‚îÄ useProducts.ts      # Products hook v·ªõi pagination
‚îÇ   ‚îî‚îÄ‚îÄ useCart.ts          # Cart management hook
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îú‚îÄ‚îÄ auth.types.ts       # Auth interfaces
‚îÇ   ‚îú‚îÄ‚îÄ product.types.ts    # Product interfaces
‚îÇ   ‚îî‚îÄ‚îÄ cart.types.ts       # Cart interfaces
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ errorHandler.ts     # Centralized error handling
```

---

## üîó T√†i nguy√™n b·ªï sung

### Backend Code Structure
```
product-be/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.routes.js      # Authentication endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product.routes.js   # Product CRUD endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cart.routes.js      # Cart management endpoints
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.routes.js # Database utilities
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.js   # Auth business logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product.controller.js # Product business logic
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cart.controller.js   # Cart business logic
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.middleware.js   # JWT verification & role check
‚îÇ   ‚îî‚îÄ‚îÄ models/
‚îÇ       ‚îú‚îÄ‚îÄ user.model.js        # User schema
‚îÇ       ‚îú‚îÄ‚îÄ product.model.js     # Product schema
‚îÇ       ‚îî‚îÄ‚îÄ cart.model.js        # Cart schema
```

### T√†i li·ªáu tham kh·∫£o
- **Axios Documentation:** https://axios-http.com
- **JWT Introduction:** https://jwt.io/introduction
- **Next.js Environment Variables:** https://nextjs.org/docs/basic-features/environment-variables

---